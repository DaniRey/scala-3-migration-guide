<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Contextual Abstractions · Scala 3 Migration guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The redesign of [contextual abstractions](https://dotty.epfl.ch/docs/reference/contextual/motivation.html) brings some incompatibilities."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Contextual Abstractions · Scala 3 Migration guide"/><meta property="og:type" content="website"/><meta property="og:url" content="https://scalacenter.github.io//scala-3-migration-guide/index.html"/><meta property="og:description" content="The redesign of [contextual abstractions](https://dotty.epfl.ch/docs/reference/contextual/motivation.html) brings some incompatibilities."/><meta property="og:image" content="https://scalacenter.github.io//scala-3-migration-guide/img/scalacenter2x.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://scalacenter.github.io//scala-3-migration-guide/img/scalacenter2x.png"/><link rel="shortcut icon" href="/scala-3-migration-guide/img/dotty-logo.svg"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Fira+Code:400,700&amp;display=fallback"/><script src="/scala-3-migration-guide/js/scrollSpy.js"></script><link rel="stylesheet" href="/scala-3-migration-guide/css/main.css"/><script src="/scala-3-migration-guide/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/scala-3-migration-guide/"><img class="logo" src="/scala-3-migration-guide/img/dotty-logo-white.svg" alt="Scala 3 Migration guide"/><h2 class="headerTitleWithLogo">Scala 3 Migration guide</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/scala-3-migration-guide/docs/get-started.html" target="_self">User Guide</a></li><li class=""><a href="/scala-3-migration-guide/docs/contributing.html" target="_self">Contribute</a></li><li class=""><a href="https://github.com/scalacenter/scala-3-migration-guide" target="_blank">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Incompatibilities</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Compatibility Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/get-started.html">Introduction</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/compatibility/source.html">Source Level</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/compatibility/classpath.html">Classpath Level</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/compatibility/runtime.html">Runtime</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/compatibility/metaprogramming.html">Metaprogramming</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tooling</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tooling/migration-tools.html">Tour of the Migration Tools</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tooling/scala-3-migration-mode.html">Scala 3 Migration Mode</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tooling/scala-3-migrate-plugin.html">Scala 3 Migrate Plugin</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tooling/scala-3-syntax-rewrites.html">Scala 3 Syntax Rewriting</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorials</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/prerequisites.html">Project Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/sbt-migration.html">sbt Migration Tutorial</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/kind-projector.html">kind-projector Migration Tutorial</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/macro-cross-building.html">Cross-Building a Macro Library</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/tutorials/macro-mixing.html">Mixing Scala 2.13 and Scala 3 Macros</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Incompatibilities</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/incompatibility-table.html">Incompatibility Table</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/syntactic-changes.html">Syntactic Changes</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/dropped-features.html">Dropped Features</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/contextual-abstractions.html">Contextual Abstractions</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/other-changed-features.html">Other Changed Features</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/type-checker.html">Type Checker</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/incompatibilities/type-inference.html">Type Inference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Compiler Options</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/compiler-options/compiler-options-table.html">Compiler Options Table</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/compiler-options/new-compiler-options.html">New Scala 3 compiler options</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Resources</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/macros/macro-libraries.html">Scala Macro Libraries</a></li><li class="navListItem"><a class="navItem" href="/scala-3-migration-guide/docs/external-resources/moving-from-scala-2-to-scala-3.html">Moving from Scala 2 to Scala 3</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/scalacenter/scala-3-migration-guide/edit/main/docs/incompatibilities/contextual-abstractions.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Contextual Abstractions</h1></header><article><div><span><p>The redesign of <a href="https://dotty.epfl.ch/docs/reference/contextual/motivation.html">contextual abstractions</a> brings some incompatibilities.</p>
<table>
<thead>
<tr><th></th><th>Scala 2.13</th><th>Scala 3 Migration Rewrite</th><th>Scalafix Rule</th><th>Comments</th></tr>
</thead>
<tbody>
<tr><td><a href="/scala-3-migration-guide/docs/incompatibilities/contextual-abstractions.html#type-of-implicit-definition">Type of implicit def</a></td><td></td><td></td><td><a href="https://github.com/ohze/scala-rewrites#fixexplicittypesexplicitimplicittypes">✅</a></td><td></td></tr>
<tr><td><a href="/scala-3-migration-guide/docs/incompatibilities/contextual-abstractions.html#implicit-views">Implicit views</a></td><td></td><td></td><td></td><td>Possible runtime incompatibility</td></tr>
<tr><td><a href="/scala-3-migration-guide/docs/incompatibilities/contextual-abstractions.html#view-bounds">View bounds</a></td><td>Deprecation</td><td></td><td></td><td></td></tr>
<tr><td><a href="/scala-3-migration-guide/docs/incompatibilities/contextual-abstractions.html#ambiguous-conversion-on-a-and--a">Ambiguous conversion on <code>A</code> and <code>=&gt; A</code></a></td><td></td><td></td><td></td><td></td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="type-of-implicit-definition"></a><a href="#type-of-implicit-definition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Type Of Implicit Definition</h2>
<p>The type of implicit definitions (<code>val</code> or <code>def</code>) needs to be given explicitly in Scala 3.
They cannot be inferred anymore.</p>
<p>The Scalafix rule named <code>ExplicitImplicitTypes</code> in <a href="https://github.com/ohze/scala-rewrites#fixexplicittypesexplicitimplicittypes">ohze/scala-rewrites</a> repository can write the missing type annotations automatically.</p>
<h2><a class="anchor" aria-hidden="true" id="implicit-views"></a><a href="#implicit-views" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implicit Views</h2>
<p>Scala 3 does not support implicit conversion from an implicit function value, of the form <code>implicit val ev: A =&gt; B</code>.</p>
<p>The following piece of code is now invalid:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Pretty</span> </span>{
  <span class="hljs-keyword">val</span> print: <span class="hljs-type">String</span>
}

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pretty</span></span>[<span class="hljs-type">A</span>](a: <span class="hljs-type">A</span>)(<span class="hljs-keyword">implicit</span> ev: <span class="hljs-type">A</span> =&gt; <span class="hljs-type">Pretty</span>): <span class="hljs-type">String</span> =
  a.print <span class="hljs-comment">// Error: value print is not a member of A</span>
</code></pre>
<p>The <a href="/scala-3-migration-guide/docs/tooling/scala-3-migration-mode.html">Scala 3 migration compilation</a> can warn you about those cases, but it does not try to fix it.</p>
<p>Be aware that this incompatibility can produce a runtime incompatibility and break your program.
Indeed the compiler can find another implicit conversion from a broader scope, which would eventualy cause an undesired behavior at runtime.</p>
<p>This example illustrates the case:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Pretty</span> </span>{
  <span class="hljs-keyword">val</span> print: <span class="hljs-type">String</span>
}

<span class="hljs-keyword">implicit</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">anyPretty</span></span>(any: <span class="hljs-type">Any</span>): <span class="hljs-type">Pretty</span> = <span class="hljs-keyword">new</span> <span class="hljs-type">Pretty</span> { <span class="hljs-keyword">val</span> print = <span class="hljs-string">"any"</span> }

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pretty</span></span>[<span class="hljs-type">A</span>](a: <span class="hljs-type">A</span>)(<span class="hljs-keyword">implicit</span> ev: <span class="hljs-type">A</span> =&gt; <span class="hljs-type">Pretty</span>): <span class="hljs-type">String</span> =
  a.print <span class="hljs-comment">// always print "any"</span>
</code></pre>
<p>The resolved conversion depends on the compiler mode:</p>
<ul>
<li><code>-source:3.0-migration</code>: the compiler performs the <code>ev</code> conversion</li>
<li><code>-source:3.0</code>: the compiler cannot perform the <code>ev</code> conversion but it can perform the <code>anyPretty</code>, which is undesired</li>
</ul>
<p>One simple fix is to supply the right conversion explicitly:</p>
<pre><code class="hljs css language-diff">def pretty[A](a: A)(implicit ev: A =&gt; Pretty): String =
<span class="hljs-deletion">-  a.print</span>
<span class="hljs-addition">+  ev(a).print</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="view-bounds"></a><a href="#view-bounds" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>View Bounds</h2>
<p>View bounds have been deprecated for a long time but they are still supported in Scala 2.13.
They do not compile in Scala 3 anymore.</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span></span>[<span class="hljs-type">A</span> &lt;% <span class="hljs-type">Long</span>](a: <span class="hljs-type">A</span>): <span class="hljs-type">Long</span> = a
</code></pre>
<p>In this example we get:</p>
<pre><code class="hljs css language-text">-- Error: src/main/scala/view-bound.scala:2:12 
2 |  def foo[A <% Long](a: A): Long = a
  |            ^
  |          view bounds `<%' are deprecated, use a context bound `:' instead
</code></pre>
<p>The message suggests to use a context bound instead of a view bound but it would change the signature of the method.
It is probably easier and safer to preserve the binary compatibility.
To do so the implicit conversion must be declared and called explicitly.</p>
<p>Be careful not to fall in the runtime incompatibility described above, in <a href="#implicit-views">Implicit Views</a>.</p>
<pre><code class="hljs css language-diff"><span class="hljs-deletion">-def foo[A &lt;% Long](a: A): Long = a</span>
<span class="hljs-addition">+def foo[A](a: A)(implicit ev: A =&gt; Long): Long = ev(a)</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="ambiguous-conversion-on-a-and--a"></a><a href="#ambiguous-conversion-on-a-and--a" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ambiguous Conversion On <code>A</code> And <code>=&gt; A</code></h2>
<p>In Scala 2.13 the implicit conversion on <code>A</code> wins over the implicit conversion on <code>=&gt; A</code>.
It is not the case in Scala 3 anymore, and leads to an ambiguous conversion.</p>
<p>For instance, in this example:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">implicit</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">boolFoo</span></span>(bool: <span class="hljs-type">Boolean</span>): <span class="hljs-type">Foo</span> = ???
<span class="hljs-keyword">implicit</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lazyBoolFoo</span></span>(lazyBool:  =&gt; <span class="hljs-type">Boolean</span>): <span class="hljs-type">Foo</span> = ???

<span class="hljs-literal">true</span>.foo()
</code></pre>
<p>The Scala 2.13 compiler chooses the <code>boolFoo</code> conversion but the Scala 3 compiler fails to compile.</p>
<pre><code class="hljs css language-text">-- Error: src/main/scala/ambiguous-conversion.scala:4:19
9 |  true.foo()
  |  ^^^^
  |Found:    (true : Boolean)
  |Required: ?{ foo: ? }
  |Note that implicit extension methods cannot be applied because they are ambiguous;
  |both method boolFoo in object Foo and method lazyBoolFoo in object Foo provide an extension method `foo` on (true : Boolean)
</code></pre>
<p>A temporary solution is to write the conversion explicitly.</p>
<pre><code class="hljs css language-diff">implicit def boolFoo(bool: Boolean): Foo = ???
implicit def lazyBoolFoo(lazyBool:  =&gt; Boolean): Foo = ???

<span class="hljs-deletion">-true.foo()</span>
<span class="hljs-addition">+boolFoo(true).foo()</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/scala-3-migration-guide/docs/incompatibilities/dropped-features.html"><span class="arrow-prev">← </span><span>Dropped Features</span></a><a class="docs-next button" href="/scala-3-migration-guide/docs/incompatibilities/other-changed-features.html"><span>Other Changed Features</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#type-of-implicit-definition">Type Of Implicit Definition</a></li><li><a href="#implicit-views">Implicit Views</a></li><li><a href="#view-bounds">View Bounds</a></li><li><a href="#ambiguous-conversion-on-a-and--a">Ambiguous Conversion On <code>A</code> And <code>=&gt; A</code></a></li></ul></nav></div><footer class="nav-footer" id="footer" style="background-color:#224951"><section class="sitemap"><a href="/scala-3-migration-guide/" class="nav-home"><img src="/scala-3-migration-guide/img/dotty-logo-white.svg" alt="Scala 3 Migration guide" width="66" height="58"/></a><div><h5>Docs</h5><a href="
                /scala-3-migration-guide/docs/compatibility.html">User Guide</a><a href="
                /scala-3-migration-guide/docs/contributing.html">Contribute</a></div><div><h5>Community</h5><a href="https://gitter.im/scala/center" target="_blank">Chat on Gitter</a><a href="https://users.scala-lang.org/" target="_blank">Discuss on Scala Users</a></div><div><h5>More</h5><a href="https://github.com/scalacenter/scala-3-migration-guide" target="_blank">GitHub</a></div></section><section class="copyright">Copyright © 2021 Scala Center</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f77e0c381ea8939fc6c34dc0e17ea492',
                indexName: 'scala-3-migration-guide',
                inputSelector: '#search_input_react'
              });
            </script></body></html>